<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hotel Booking System - Performance Test Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: #333;
        background-color: #f8f9fa;
        padding-top: 20px;
        padding-bottom: 40px;
      }
      .card {
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: none;
      }
      .card-header {
        font-weight: 600;
        background-color: #0275d8;
        color: white;
      }
      .summary-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }
      .stat-box {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        text-align: center;
      }
      .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #0275d8;
      }
      .stat-label {
        font-size: 14px;
        color: #666;
      }
      canvas {
        max-height: 300px;
      }
      .alert-info {
        background-color: #e7f2fa;
        border-color: #c9e2f5;
        color: #0c5460;
      }
      .concurrency-warning {
        color: #721c24;
        background-color: #f8d7da;
        border-color: #f5c6cb;
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="text-center mb-4">Hotel Booking System - Performance Test Results</h1>
      <p class="text-center text-muted">Transaction Management & Concurrency Control Analysis</p>

      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">Test Summary</div>
            <div class="card-body">
              <div class="summary-stats">
                <div class="stat-box">
                  <div class="stat-value" id="totalRequests">-</div>
                  <div class="stat-label">Total Requests</div>
                </div>
                <div class="stat-box">
                  <div class="stat-value" id="avgResponseTime">-</div>
                  <div class="stat-label">Avg Response Time</div>
                </div>
                <div class="stat-box">
                  <div class="stat-value" id="throughput">-</div>
                  <div class="stat-label">Requests/sec</div>
                </div>
                <div class="stat-box">
                  <div class="stat-value" id="errorRate">-</div>
                  <div class="stat-label">Error Rate</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Transaction Types</div>
            <div class="card-body">
              <canvas id="transactionTypesChart"></canvas>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Transaction Status</div>
            <div class="card-body">
              <canvas id="transactionStatusChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Response Status Codes</div>
            <div class="card-body">
              <canvas id="statusCodesChart"></canvas>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Request Methods</div>
            <div class="card-body">
              <canvas id="requestMethodsChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">Concurrency Analysis</div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <canvas id="concurrencyIssuesChart"></canvas>
                </div>
                <div class="col-md-6">
                  <div class="alert alert-info">
                    <h5>Concurrency Control Insights</h5>
                    <p>This section analyzes how well the system handles concurrent operations.</p>
                    <ul id="concurrencyInsights">
                      <li>Loading insights...</li>
                    </ul>
                  </div>
                  <div id="concurrencyWarning" class="concurrency-warning" style="display: none"><strong>Warning:</strong> <span id="warningText"></span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">Booking Operations Performance</div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <canvas id="bookingOperationsChart"></canvas>
                </div>
                <div class="col-md-6">
                  <canvas id="responseTimeByEndpointChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">Recommendations</div>
            <div class="card-body">
              <div id="recommendations">
                <p>Analyzing test results to generate recommendations...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Load data and visualize -->
    <script>
      // This would be replaced with actual data from your test run
      const testData = {
        summary: {
          totalRequests: 10000,
          avgResponseTime: 45.2,
          throughput: 82.5,
          errorRate: "2.3%",
        },
        transactionTypes: {
          CREATE_BOOKING: 2500,
          PROCESS_PAYMENT: 2200,
          UPDATE_BOOKING: 1500,
          CANCEL_BOOKING: 800,
          PROCESS_REFUND: 400,
          OTHER: 2600,
        },
        transactionStatus: {
          SUCCESS: 9770,
          FAILED: 230,
        },
        statusCodes: {
          200: 7200,
          201: 2100,
          400: 120,
          404: 30,
          500: 50,
        },
        requestMethods: {
          GET: 4500,
          POST: 3800,
          PUT: 1200,
          DELETE: 500,
        },
        concurrencyIssues: {
          "Serialization failures": 15,
          Deadlocks: 3,
          "Concurrent modifications": 27,
          "Row-level locks": 1850,
        },
        bookingOperations: {
          "Create booking": {
            success: 2450,
            failed: 50,
            avgTime: 78.3,
          },
          "Process payment": {
            success: 2150,
            failed: 50,
            avgTime: 64.2,
          },
          "Update booking": {
            success: 1480,
            failed: 20,
            avgTime: 55.7,
          },
          "Cancel booking": {
            success: 790,
            failed: 10,
            avgTime: 42.1,
          },
          "Process refund": {
            success: 390,
            failed: 10,
            avgTime: 68.5,
          },
        },
        responseTimeByEndpoint: {
          "/api/v1/bookings (POST)": 78.3,
          "/api/v1/receipts (POST)": 64.2,
          "/api/v1/bookings/:id (PUT)": 55.7,
          "/api/v1/bookings/:id (DELETE)": 42.1,
          "/api/v1/receipts/refund (POST)": 68.5,
          "/api/v1/rooms (GET)": 35.2,
          "/api/v1/rooms/available (POST)": 38.9,
          "/api/v1/rooms/:id (GET)": 29.8,
        },
      };

      // Update summary stats
      document.getElementById("totalRequests").textContent = testData.summary.totalRequests.toLocaleString();
      document.getElementById("avgResponseTime").textContent = testData.summary.avgResponseTime + "ms";
      document.getElementById("throughput").textContent = testData.summary.throughput;
      document.getElementById("errorRate").textContent = testData.summary.errorRate;

      // Transaction Types Chart
      const transactionTypesChart = new Chart(document.getElementById("transactionTypesChart"), {
        type: "pie",
        data: {
          labels: Object.keys(testData.transactionTypes),
          datasets: [
            {
              data: Object.values(testData.transactionTypes),
              backgroundColor: ["#4285F4", "#34A853", "#FBBC05", "#EA4335", "#8F00FF", "#00ACC1"],
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: "right",
            },
            title: {
              display: true,
              text: "Transaction Distribution",
            },
          },
        },
      });

      // Transaction Status Chart
      const transactionStatusChart = new Chart(document.getElementById("transactionStatusChart"), {
        type: "doughnut",
        data: {
          labels: Object.keys(testData.transactionStatus),
          datasets: [
            {
              data: Object.values(testData.transactionStatus),
              backgroundColor: ["#34A853", "#EA4335"],
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: "right",
            },
            title: {
              display: true,
              text: "Transaction Success vs Failure",
            },
          },
        },
      });

      // Status Codes Chart
      const statusCodesChart = new Chart(document.getElementById("statusCodesChart"), {
        type: "bar",
        data: {
          labels: Object.keys(testData.statusCodes),
          datasets: [
            {
              label: "Count",
              data: Object.values(testData.statusCodes),
              backgroundColor: ["#34A853", "#34A853", "#FBBC05", "#FBBC05", "#EA4335"],
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false,
            },
            title: {
              display: true,
              text: "HTTP Status Codes",
            },
          },
        },
      });

      // Request Methods Chart
      const requestMethodsChart = new Chart(document.getElementById("requestMethodsChart"), {
        type: "bar",
        data: {
          labels: Object.keys(testData.requestMethods),
          datasets: [
            {
              label: "Count",
              data: Object.values(testData.requestMethods),
              backgroundColor: "#4285F4",
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false,
            },
            title: {
              display: true,
              text: "HTTP Methods",
            },
          },
        },
      });

      // Concurrency Issues Chart
      const concurrencyIssuesChart = new Chart(document.getElementById("concurrencyIssuesChart"), {
        type: "bar",
        data: {
          labels: Object.keys(testData.concurrencyIssues),
          datasets: [
            {
              label: "Count",
              data: Object.values(testData.concurrencyIssues),
              backgroundColor: ["#EA4335", "#EA4335", "#EA4335", "#4285F4"],
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              type: "logarithmic",
            },
          },
          plugins: {
            legend: {
              display: false,
            },
            title: {
              display: true,
              text: "Concurrency Events",
            },
          },
        },
      });

      // Booking Operations Chart
      const bookingOperationsData = {
        labels: Object.keys(testData.bookingOperations),
        datasets: [
          {
            label: "Success",
            data: Object.values(testData.bookingOperations).map((op) => op.success),
            backgroundColor: "#34A853",
          },
          {
            label: "Failed",
            data: Object.values(testData.bookingOperations).map((op) => op.failed),
            backgroundColor: "#EA4335",
          },
        ],
      };

      const bookingOperationsChart = new Chart(document.getElementById("bookingOperationsChart"), {
        type: "bar",
        data: bookingOperationsData,
        options: {
          responsive: true,
          scales: {
            x: {
              stacked: true,
            },
            y: {
              stacked: true,
            },
          },
          plugins: {
            title: {
              display: true,
              text: "Booking Operations",
            },
          },
        },
      });

      // Response Time by Endpoint Chart
      const responseTimeByEndpointChart = new Chart(document.getElementById("responseTimeByEndpointChart"), {
        type: "bar",
        data: {
          labels: Object.keys(testData.responseTimeByEndpoint),
          datasets: [
            {
              label: "Avg Response Time (ms)",
              data: Object.values(testData.responseTimeByEndpoint),
              backgroundColor: "#4285F4",
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false,
            },
            title: {
              display: true,
              text: "Response Time by Endpoint",
            },
          },
        },
      });

      // Generate concurrency insights
      const concurrencyInsightsList = document.getElementById("concurrencyInsights");
      concurrencyInsightsList.innerHTML = "";

      // Calculate total concurrency issues
      const totalIssues = testData.concurrencyIssues["Serialization failures"] + testData.concurrencyIssues["Deadlocks"] + testData.concurrencyIssues["Concurrent modifications"];

      // Add insights based on data
      const totalRequests = testData.summary.totalRequests;
      const issueRate = ((totalIssues / totalRequests) * 100).toFixed(2);

      const insights = [`<strong>Issue Rate:</strong> ${issueRate}% of requests experienced concurrency issues.`, `<strong>Locking Strategy:</strong> ${testData.concurrencyIssues["Row-level locks"]} row-level locks were successfully acquired.`, `<strong>Most Common Issue:</strong> Concurrent modifications (${testData.concurrencyIssues["Concurrent modifications"]} occurrences).`];

      insights.forEach((insight) => {
        const li = document.createElement("li");
        li.innerHTML = insight;
        concurrencyInsightsList.appendChild(li);
      });

      // Show warning if issue rate is high
      if (issueRate > 1.0) {
        document.getElementById("concurrencyWarning").style.display = "block";
        document.getElementById("warningText").textContent = `High concurrency issue rate detected (${issueRate}%). Consider reviewing transaction isolation levels.`;
      }

      // Generate recommendations
      const recommendationsElement = document.getElementById("recommendations");

      // Create recommendations based on test results
      const recommendations = [];

      if (testData.summary.avgResponseTime > 50) {
        recommendations.push(`
                <div class="alert alert-warning">
                    <strong>Performance Concern:</strong> Average response time (${testData.summary.avgResponseTime}ms) is above the target of 50ms.
                    Consider optimizing database queries and adding appropriate indexes.
                </div>
            `);
      }

      if (issueRate > 0.5) {
        recommendations.push(`
                <div class="alert alert-warning">
                    <strong>Concurrency Management:</strong> The concurrency issue rate (${issueRate}%) indicates room for improvement.
                    Consider implementing more robust optimistic locking strategies or reviewing transaction isolation levels.
                </div>
            `);
      }

      // Add general recommendations
      recommendations.push(`
            <div class="alert alert-info">
                <strong>Transaction Management:</strong> The system processed ${testData.transactionTypes.CREATE_BOOKING + testData.transactionTypes.PROCESS_PAYMENT} 
                booking and payment transactions with a ${((testData.transactionStatus.SUCCESS / totalRequests) * 100).toFixed(2)}% success rate.
                This indicates that the transaction management system is working effectively.
            </div>
        `);

      if (Object.values(testData.bookingOperations).some((op) => op.avgTime > 70)) {
        recommendations.push(`
                <div class="alert alert-warning">
                    <strong>Slow Operations:</strong> Some booking operations are taking more than 70ms on average.
                    Consider profiling these operations to identify bottlenecks:
                    <ul>
                        ${Object.entries(testData.bookingOperations)
                          .filter(([_, op]) => op.avgTime > 70)
                          .map(([name, op]) => `<li>${name}: ${op.avgTime}ms</li>`)
                          .join("")}
                    </ul>
                </div>
            `);
      }

      recommendationsElement.innerHTML = recommendations.join("");
    </script>
  </body>
</html>
